# external_models.py
from typing import Dict, Optional

def _make_silence_wav_bytes(duration_sec: float = 0.25, sr: int = 16000) -> bytes:
    import io, wave, struct
    buf = io.BytesIO()
    with wave.open(buf, "wb") as wf:
        wf.setnchannels(1)
        wf.setsampwidth(2)  # 16-bit PCM
        wf.setframerate(sr)
        frames = int(duration_sec * sr)
        for _ in range(frames):
            wf.writeframesraw(struct.pack("<h", 0))
    return buf.getvalue()

def melody_generate(prefix_token: Dict) -> bytes:
    #외부 멜로디 생성 모델 자리
    print("[melody_generate] prefix_token:", prefix_token)
    return _make_silence_wav_bytes(duration_sec=0.20)

def musicgen_generate(prefix_token: Dict, conditioning_wav: Optional[bytes] = None) -> bytes:
    #외부 MusicGen-Melody 모델 자리
    print("[musicgen_generate] prefix_token:", prefix_token,"| conditioning:", "yes" if conditioning_wav else "no")
    return _make_silence_wav_bytes(duration_sec=0.30)

